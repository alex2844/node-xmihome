# Как внести свой вклад

Мы рады любому вкладу в развитие проекта! Чтобы сделать процесс совместной
работы гладким и эффективным, пожалуйста, ознакомьтесь с этими
рекомендациями.

## Стиль оформления коммитов

Этот проект использует стандарт [Conventional Commits](https://www.conventionalcommits.org/)
для автоматической генерации списка изменений (changelog). Пожалуйста,
придерживайтесь этого формата в ваших коммитах.

### Формат сообщения

Сообщение коммита должно быть структурировано следующим образом:

```markdown
тип(область): описание
```

* **тип**: Одно из ключевых слов ниже.
* **область** (необязательно): Часть проекта, которую затронули изменения.
* **описание**: Краткое описание в повелительном наклонении (например,
    "исправить", а не "исправил").

### Как выбрать область (scope)?

Главная цель области — быстро дать контекст. Руководствуйтесь следующими
правилами:

* **Для пакетов `node`, `node-red`, `web`:** Используйте имя пакета.
    > `fix(node): исправить обработку ошибок в miot`
    > `feat(web): добавить кнопку для переподключения`

* **Для пакета `devices`:** Используйте **имя файла устройства** (без `.js`).
    > `feat(roidmi.vacuum): добавить получение карты`
    > `fix(xiaomi.scales): исправить расчет BMI`

* **Для сквозных изменений:** Если изменение затрагивает несколько пакетов или
    конфигурацию в корне (CI, скрипты), область можно **опустить**.
    > `chore: обновить версию bun`

### Основные типы коммитов

Используйте следующие типы в повелительном наклонении:

* **feat**: Добавление новой функциональности.
    > `feat(vacuum): добавить методы для получения карты и списка комнат`

* **fix**: Исправление ошибки.
    > `fix(web): исправить опечатку в заголовке на главной странице`

* **docs**: Изменения, касающиеся только документации.
    > `docs(readme): обновить инструкцию по установке`

* **ci**: Изменения, связанные с CI/CD (настройка GitHub Actions).
    > `ci(release): исправить синтаксис в workflow`

* **chore**: Прочие изменения, не затрагивающие код или тесты.
    > `chore(deps): обновить версию typescript`

## Публикация и Релизы

Процесс выпуска новых версий может быть как полностью автоматизированным,
так и выполняться вручную.

### Полный автоматический релиз (Рекомендуемый способ)

Этот способ одновременно публикует пакеты в NPM и создает релиз на GitHub.
Процесс запускается созданием нового тега.

1. **Убедитесь, что все изменения находятся в ветке `main`** и отправлены
    на GitHub.

2. **Создайте новый Git-тег.** Версия должна соответствовать правилам
    семантического версионирования (SemVer).

    ```bash
    # Например, для версии 1.2.0
    git tag v1.2.0
    ```

3. **Отправьте тег на GitHub.** Именно эта команда запускает workflow.

    ```bash
    git push origin v1.2.0
    ```

После этого GitHub Actions автоматически выполнит все необходимые шаги.

### Публикация только в NPM (Локально)

Вы можете опубликовать пакеты в NPM напрямую с вашего локального компьютера,
не создавая при этом релиз на GitHub. Этот способ полезен для публикации
тестовых версий или хотфиксов.

1. **Авторизуйтесь в NPM.** Если вы еще не авторизованы, выполните команду:

    ```bash
    bunx npm login
    ```

2. **Запустите скрипт публикации.** Вы можете передать версию аргументом
    или использовать ту, что указана в корневом `package.json`.

    ```bash
    # Использовать версию из package.json
    bun run publish

    # Указать конкретную версию (например, для beta-релиза)
    bun run publish 1.2.0-beta.0
    ```

**Важно:** Если вы опубликовали версию локально, а затем создали тег для
этой же версии, автоматический workflow корректно определит, что версия уже
существует в NPM, пропустит шаг публикации и просто создаст релиз на GitHub.
Процесс не сломается.
