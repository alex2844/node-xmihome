# Класс: XiaomiMiHome

Основной класс для взаимодействия с устройствами Xiaomi Mi Home. Он управляет подключениями, обнаружением устройств и предоставляет доступ к экземплярам устройств.

## Конструктор

### `new XiaomiMiHome(config)`

Создает новый экземпляр клиента `XiaomiMiHome`.

**Параметры:**

| Имя | Тип | Описание |
|---|---|---|
| `config` | `object` | Объект конфигурации. |
| `config.credentials` | `object` | (Опционально) Учетные данные для облака Xiaomi. Требуются для облачных операций. |
| `config.credentials.username` | `string` | Имя пользователя аккаунта Xiaomi. |
| `config.credentials.password` | `string` | Пароль от аккаунта Xiaomi. |
| `config.credentials.country` | `string` | Регион аккаунта Xiaomi (например, `ru`, `cn`, `us`). |
| `config.connectionType` | `string` | (Опционально) Тип подключения по умолчанию для обнаружения и подключения устройств (`'cloud'`, `'miio'`, `'bluetooth'`). |
| `config.devices` | `object[]` | (Опционально) Массив предопределенных конфигураций устройств. |
| `config.logLevel` | `string` | (Опционально) Уровень логирования для вывода в консоль (`'none'`, `'error'`, `'warn'`, `'info'`, `'debug'`). По умолчанию: `'none'`. |

**Пример:**

```javascript
import { XiaomiMiHome } from 'xmihome';

const miHome = new XiaomiMiHome({
  credentials: {
    username: 'your-email@example.com',
    password: 'your-password',
    country: 'sg'
  },
  logLevel: 'info'
});
```

## Методы

### `getDevices(options)`

Обнаруживает доступные устройства в соответствии с указанной стратегией.

**Параметры:**

| Имя | Тип | Описание |
|---|---|---|
| `options` | `object` | (Опционально) Опции обнаружения. |
| `options.timeout` | `number` | (Опционально) Таймаут для локального (MiIO/Bluetooth) обнаружения в миллисекундах. По умолчанию: `10000`. |
| `options.connectionType` | `string` | (Опционально) Метод обнаружения (`'cloud'`, `'miio'`, `'bluetooth'`). Переопределяет значение по умолчанию из конструктора. |
| `options.onDeviceFound` | `function` | (Опционально) Callback-функция для фильтрации и управления процессом обнаружения. Получает `(device, devices, type)` и может вернуть `true` для включения, `false` для пропуска, или объект `{ include?: boolean, stop?: boolean }` для управления потоком. |

**Возвращает:**

- `Promise<object[]>`: Промис, который разрешается массивом конфигураций найденных устройств.

### `getDevice(deviceConfig)`

Создает или извлекает из кэша экземпляр `Device` для конкретного устройства.

**Параметры:**

| Имя | Тип | Описание |
|---|---|---|
| `deviceConfig` | `object` | Конфигурация устройства для получения (должна содержать `id`, `address` или `mac`). |

**Возвращает:**

- `Promise<Device>`: Промис, который разрешается экземпляром `Device`.

### `destroy()`

Освобождает все ресурсы, используемые клиентом, включая активные подключения и таймеры. Важно вызывать этот метод, когда клиент больше не нужен, для чистого завершения работы.

**Возвращает:**

- `Promise<void>`

### `getHome()`

Получает список домов (помещений) пользователя из облака Xiaomi.

**Возвращает:**

- `Promise<object[]>`: Промис, который разрешается массивом объектов домов.

### `getEnv(home_id)`

Получает данные об окружающей среде для указанного дома из облака Xiaomi.

**Параметры:**

| Имя | Тип | Описание |
|---|---|---|
| `home_id` | `number` | ID дома, для которого запрашиваются данные. |

**Возвращает:**

- `Promise<object>`: Промис, который разрешается объектом с данными об окружающей среде.

### `log(level, ...args)`

Записывает лог-сообщение. Учитывает `logLevel`, установленный в конструкторе, и переменную окружения `NODE_DEBUG=xmihome`.

**Параметры:**

| Имя | Тип | Описание |
|---|---|---|
| `level` | `string` | Уровень сообщения (`'error'`, `'warn'`, `'info'`, `'debug'`). |
| `...args` | `any` | Аргументы для логирования, аналогично `console.log`. |

**Возвращает:**

- `void`
