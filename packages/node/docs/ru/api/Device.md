# Класс: Device

Базовый класс для всех устройств Xiaomi. Предоставляет унифицированный
интерфейс для подключения, управления свойствами и подписки на уведомления.

Экземпляры этого класса обычно создаются через метод
`XiaomiMiHome.getDevice()`.

## Статические методы

### `registerModels(models)`

Регистрирует классы устройств из пакета `xmihome-devices`, делая их
доступными для `findModel` и `create`.

**Параметры:**

| Имя      | Тип      | Описание                                                      |
| -------- | -------- | ------------------------------------------------------------- |
| `models` | `object` | Объект, где ключи - это модели, а значения - классы устройств. |

### `getModels()`

Получает список всех зарегистрированных моделей устройств.

**Возвращает:**

- `string[]`: Массив строк с моделями.

### `findModel(device)`

Находит подходящий класс для устройства на основе его `model` или `name`.

**Параметры:**

| Имя      | Тип      | Описание                          |
| -------- | -------- | --------------------------------- |
| `device` | `object` | Конфигурационный объект устройства. |

**Возвращает:**

- `typeof Device \| undefined`: Найденный класс устройства или `undefined`.

### `valid(device, model)`

Проверяет, соответствует ли конфигурация устройства конкретному классу модели.

**Параметры:**

| Имя      | Тип      | Описание                            |
| -------- | -------- | ----------------------------------- |
| `device` | `object` | Конфигурационный объект устройства. |
| `model`  | `class`  | Проверяемый класс устройства.       |

**Возвращает:**

- `boolean`: `true`, если соответствует, и `false` в противном случае.

### `create(device, client)`

Создает экземпляр нужного класса устройства (`Device` или его подкласс) на
основе модели. Если для модели нет специального класса, пытается
загрузить спецификацию из облака MiOT.

**Параметры:**

| Имя      | Тип            | Описание                          |
| -------- | -------------- | --------------------------------- |
| `device` | `object`       | Конфигурационный объект устройства. |
| `client` | `XiaomiMiHome` | Экземпляр основного клиента.       |

**Возвращает:**

- `Promise<Device>`: Промис, который разрешается экземпляром `Device`.

### `getDeviceId(device)`

Генерирует уникальный строковый идентификатор для экземпляра устройства
на основе его конфигурации.

**Параметры:**

| Имя      | Тип      | Описание                          |
| -------- | -------- | --------------------------------- |
| `device` | `object` | Конфигурационный объект устройства. |

**Возвращает:**

- `string`: Уникальный ключ для устройства.

### `getDeviceType(device, credentials)`

Определяет наиболее вероятный тип подключения (`miio`, `bluetooth`,
`cloud`) на основе доступных полей в конфигурации устройства.

**Параметры:**

| Имя           | Тип      | Описание                             |
| ------------- | -------- | ------------------------------------ |
| `device`      | `object` | Конфигурационный объект устройства.   |
| `credentials` | `object` | (Опционально) Учетные данные облака. |

**Возвращает:**

- `'miio' \| 'bluetooth' \| 'cloud' \| undefined`: Строка с типом подключения.

## Свойства

| Имя              | Тип       | Описание                                                          |
| ---------------- | --------- | ----------------------------------------------------------------- |
| `connectionType` | `string`  | Текущий тип подключения (`'miio'`, `'bluetooth'`, `'cloud'`) или `undefined`, если не подключено. |
| `isConnected`    | `boolean` | `true`, если устройство в данный момент подключено.               |
| `isConnecting`   | `boolean` | `true`, если устройство находится в процессе первоначального подключения. |
| `isReconnecting` | `boolean` | `true`, если устройство находится в процессе автоматического переподключения. |
| `properties`     | `object`  | Объект, содержащий определения всех свойств устройства.           |
| `actions`        | `object`  | Объект, содержащий определения всех действий устройства.          |

## События

Экземпляры класса `Device` генерируют следующие события:

| Событие          | Данные                                 | Описание                                                     |
| ---------------- | -------------------------------------- | ------------------------------------------------------------ |
| `connected`      | `string` (connectionType)            | Генерируется при успешном установлении соединения с устройством. |
| `disconnect`     | -                                      | Генерируется при разрыве соединения, как при вызове `disconnect()`, так и по внешним причинам. |
| `reconnecting`   | `{ reason: string }`                   | Генерируется, когда начинается процесс автоматического переподключения после неожиданного разрыва связи. |
| `reconnect_failed` | `{ attempts: number, error?: string }` | Генерируется, когда процесс автоматического переподключения завершается неудачей после всех попыток. |

## Методы

### `connect(connectionType)`

Устанавливает соединение с устройством. Тип подключения определяется
автоматически, если не указан явно. Метод отдает приоритет аргументу
`connectionType`, затем использует настройку по умолчанию из клиента и в
последнюю очередь пытается определить тип автоматически по доступным данным
устройства.

**Параметры:**

| Имя              | Тип      | Описание                                                             |
| ---------------- | -------- | -------------------------------------------------------------------- |
| `connectionType` | `string` | (Опционально) Предпочитаемый тип подключения (`'miio'`, `'bluetooth'`, `'cloud'`). |

**Возвращает:**

- `Promise<void>`

### `disconnect()`

Разрывает соединение с устройством.

**Возвращает:**

- `Promise<void>`

### `getName()`

Получает имя устройства.

**Возвращает:**

- `string`: Имя устройства.

### `getModel()`

Получает идентификатор модели устройства.

**Возвращает:**

- `string`: Строка модели устройства.

### `getProperty(prop)`

Получает значение одного свойства.

**Параметры:**

| Имя    | Тип               | Описание                                      |
| ------ | ----------------- | --------------------------------------------- |
| `prop` | `string \| object` | Имя свойства или объект определения свойства. |

**Возвращает:**

- `Promise<any>`: Промис, который разрешается значением свойства.

### `getProperties(properties)`

Получает значения нескольких свойств. Если `properties` не указан,
запрашивает все читаемые свойства.

**Параметры:**

| Имя          | Тип                    | Описание                                                             |
| ------------ | ---------------------- | -------------------------------------------------------------------- |
| `properties` | `(string \| object)[]` | (Опционально) Массив имен или объектов определения свойств для получения. |

**Возвращает:**

- `Promise<object>`: Промис, который разрешается объектом
  `{ propertyName: value, ... }`.

### `setProperty(prop, value)`

Устанавливает значение для одного свойства.

**Параметры:**

| Имя     | Тип               | Описание                                      |
| ------- | ----------------- | --------------------------------------------- |
| `prop`  | `string \| object` | Имя свойства или объект определения свойства. |
| `value` | `any`             | Новое значение для свойства.                  |

**Возвращает:**

- `Promise<void>`

### `callAction(action, value)`

Вызывает определенное действие на устройстве. Используется для операций,
которые не вписываются в модель get/set, например, запуск цикла уборки на
пылесосе.

**Параметры:**

| Имя      | Тип               | Описание                                     |
| -------- | ----------------- | -------------------------------------------- |
| `action` | `string \| object` | Имя действия или объект определения действия. |
| `value`  | `any[]`           | (Опционально) Массив параметров для действия. |

**Возвращает:**

- `Promise<any>`: Промис, который разрешается результатом выполнения
  действия.

### `startNotify(prop, callback)`

Подписывается на уведомления об изменении значения свойства.

**Параметры:**

| Имя        | Тип               | Описание                                                               |
| ---------- | ----------------- | ---------------------------------------------------------------------- |
| `prop`     | `string \| object` | Имя свойства или объект определения свойства для подписки.              |
| `callback` | `function`        | Функция, которая будет вызываться с новым значением при каждом изменении. |

**Возвращает:**

- `Promise<void>`

### `stopNotify(prop)`

Отменяет подписку на уведомления для свойства.

**Параметры:**

| Имя    | Тип               | Описание                                                  |
| ------ | ----------------- | --------------------------------------------------------- |
| `prop` | `string \| object` | Имя свойства или объект определения свойства для отписки. |

**Возвращает:**

- `Promise<void>`

### `startMonitoring(callback)`

Запускает пассивный мониторинг рекламных пакетов (advertisements)
устройства. Это доступно только для Bluetooth-устройств и не требует
постоянного соединения.

**Параметры:**

| Имя        | Тип        | Описание                                                               |
| ---------- | ---------- | ---------------------------------------------------------------------- |
| `callback` | `function` | Функция, вызываемая с распарсенными данными из рекламного пакета.        |

**Возвращает:**

- `Promise<void>`

### `stopMonitoring()`

Останавливает пассивный мониторинг рекламных пакетов.

**Возвращает:**

- `Promise<void>`

### `auth()`

Выполняет специфичную для устройства логику аутентификации. Этот метод
предназначен для переопределения в дочерних классах для устройств,
требующих особой аутентификации (например, Mi Kettle).

**Возвращает:**

- `Promise<void>`
