# Класс: Bluetooth

Класс для низкоуровневого взаимодействия с Bluetooth LE устройствами через
D-Bus. Обычно используется внутренне клиентом `XiaomiMiHome`.

## Статические методы

### `createBluetooth()`

Создает и инициализирует новый экземпляр класса Bluetooth. Это
рекомендуемый способ создания отдельного экземпляра.

**Возвращает:**

- `Promise<Bluetooth>`: Промис, который разрешается инициализированным
  экземпляром Bluetooth.

## Методы

### `registerBindKey(mac, bindkey)`

Регистрирует bindkey для конкретного устройства. Это необходимо для
расшифровки рекламных пакетов (advertisements) от защищенных MiBeacon (BLE)
устройств.

**Параметры:**

| Имя       | Тип      | Описание                                  |
| --------- | -------- | ----------------------------------------- |
| `mac`     | `string` | MAC-адрес устройства.                     |
| `bindkey` | `string` | 16-байтовый ключ шифрования в формате hex. |

### `checkBlueZService()`

Проверяет, доступен ли сервис BlueZ (стандартный Bluetooth-стек Linux)
через D-Bus. Полезно для диагностики проблем с Bluetooth на системах Linux
перед попыткой инициализации адаптера.

**Возвращает:**

- `Promise<boolean>`: Промис, который разрешается в `true`, если сервис
  доступен, и `false` в противном случае.

### `startDiscovery(filters)`

Запускает сканирование Bluetooth LE устройств.

**Параметры:**

| Имя       | Тип        | Описание                                                        |
| --------- | ---------- | --------------------------------------------------------------- |
| `filters` | `string[]` | (Опционально) Массив UUID сервисов для фильтрации сканирования. |

**Возвращает:**

- `Promise<boolean>`: Промис, который разрешается в `true`, если
  обнаружение было успешно запущено.

### `stopDiscovery()`

Останавливает сканирование Bluetooth LE устройств.

**Возвращает:**

- `Promise<void>`

### `getDevice(mac)`

Получает прокси-объект для взаимодействия с Bluetooth-устройством по его
MAC-адресу. Если устройство не найдено в кэше, будет выполнено
сканирование.

**Параметры:**

| Имя   | Тип      | Описание              |
| ----- | -------- | --------------------- |
| `mac` | `string` | MAC-адрес устройства. |

**Возвращает:**

- `Promise<object>`: Промис, который разрешается прокси-объектом
  устройства, предоставляющим методы `connect`, `disconnect`,
  `getCharacteristic` и др.

### `waitDevice(mac, ms)`

Ожидает обнаружения определенного Bluetooth-устройства.

**Параметры:**

| Имя   | Тип                | Описание                                                                        |
| ----- | ------------------ | ------------------------------------------------------------------------------- |
| `mac` | `string`           | MAC-адрес устройства для ожидания.                                              |
| `ms`  | `number` \| `null` | (Опционально) Макс. время ожидания в мс. Если `null`, ожидание бессрочно.       |

**Возвращает:**

- `Promise<object>`: Промис, который разрешается объектом конфигурации
  найденного устройства.

### `removeDevice(mac)`

Удаляет устройство из кэша BlueZ и разрывает соединение, если оно
установлено.

**Параметры:**

| Имя   | Тип      | Описание              |
| ----- | -------- | --------------------- |
| `mac` | `string` | MAC-адрес устройства. |

**Возвращает:**

- `Promise<boolean>`

### `startMonitoring()`

Запускает режим пассивного мониторинга рекламных пакетов.

**Возвращает:**

- `Promise<boolean>`

### `stopMonitoring()`

Останавливает режим пассивного мониторинга.

**Возвращает:**

- `Promise<void>`

### `defaultAdapter(device)`

Инициализирует Bluetooth-адаптер по умолчанию. Обычно этот метод
вызывается внутренне.

**Параметры:**

| Имя      | Тип      | Описание                                                  |
| -------- | -------- | --------------------------------------------------------- |
| `device` | `string` | (Опционально) Имя адаптера для использования (например, `hci0`). |

**Возвращает:**

- `Promise<object>`: Промис, который разрешается объектом интерфейса
  адаптера.

### `extractProperties(properties)`

Извлекает свойства из объекта D-Bus Variant. Это служебный метод,
используемый внутренне для обработки данных, полученных от D-Bus.

**Параметры:**

| Имя          | Тип      | Описание                                           |
| ------------ | -------- | -------------------------------------------------- |
| `properties` | `object` | Объект свойств D-Bus, содержащий значения Variant. |

**Возвращает:**

- `object`: Обычный JavaScript объект с извлеченными свойствами.

### `destroy()`

Освобождает ресурсы, останавливает сканирование и отключает все
подключенные устройства.

**Возвращает:**

- `Promise<void>`

## События

Класс `Bluetooth` генерирует следующие события:

| Событие                | Данные   | Описание                                           |
| ---------------------- | -------- | -------------------------------------------------- |
| `adapter`              | `object` | Генерируется при изменении свойств адаптера.       |
| `available`            | `object` | Генерируется при обнаружении любого нового девайса.|
| `available:dev_${id}`  | `object` | Генерируется при обнаружении конкретного девайса.  |
| `advertisement`        | `object` | Генерируется при получении любого пакета BLE.      |
| `advertisement:${mac}` | `object` | Генерируется при получении пакета от девайса.      |
| `properties:${id}`     | `object` | Генерируется при изменении свойств D-Bus девайса.  |

