# Класс: Miot

Класс для взаимодействия с облаком Xiaomi и устройствами по протоколу
MiIO. Обычно используется внутренне клиентом `XiaomiMiHome`.

## Статические методы

### `findModel(model)`

Ищет спецификацию устройства на `miot-spec.org` по его модели.

**Параметры:**

| Имя     | Тип      | Описание                                          |
| ------- | -------- | ------------------------------------------------- |
| `model` | `string` | Модель устройства (например, `deerma.humidifier.jsq2w`). |

**Возвращает:**

- `Promise<object|undefined>`: Промис, разрешающийся спецификацией.

## Свойства

| Имя           | Тип      | Описание                                                                            |
| ------------- | -------- | ----------------------------------------------------------------------------------- |
| `credentials` | `object` | Доступ к облачным учетным данным из основной конфигурации клиента.                  |
| `miio`        | `object` | Прямой доступ к библиотеке `mijia-io` для низкоуровневых операций с MiIO.           |

## Методы

### `login(handlers)`

Выполняет вход в аккаунт Xiaomi. Поддерживает двухфакторную
аутентификацию (2FA) и Капчу через колбэки.

**Параметры:**

| Имя                | Тип                          | Описание                                                                            |
| ------------------ | ---------------------------- | ----------------------------------------------------------------------------------- |
| `handlers`         | `object`                     | (Опционально) Объект с обработчиками интерактивных шагов.                           |
| `handlers.on2fa`   | `(url: str) => Promise<str>` | (Опционально) Функция, принимающая URL верификации и возвращающая код подтверждения.|
| `handlers.onCaptcha`| `(img: str) => Promise<str>`| (Опционально) Функция, принимающая изображение капчи (base64) и возвращающая текст. |

**Возвращает:**

- `Promise<object>`: Промис, разрешающийся объектом с токенами
  (`userId`, `ssecurity`, `serviceToken`).

### `request(path, data)`

Выполняет подписанный запрос к облачному API Xiaomi.

**Параметры:**

| Имя    | Тип      | Описание                                        |
| ------ | -------- | ----------------------------------------------- |
| `path` | `string` | Путь API-эндпоинта (например, `/home/device_list`). |
| `data` | `object` | Объект с данными для отправки.                  |

**Возвращает:**

- `Promise<object>`: Промис, который разрешается JSON-ответом от сервера.

### `parseJson(str)`

Разбирает JSON-строку, удаляя префикс `&&&START&&&`, если он есть.

**Параметры:**

| Имя   | Тип      | Описание    |
| ----- | -------- | ----------- |
| `str` | `string` | JSON-строка. |

**Возвращает:**

- `object`: Разобранный JSON-объект.

### `getApiUrl(country)`

Возвращает URL API для указанной страны.

**Параметры:**

| Имя       | Тип      | Описание                        |
| --------- | -------- | ------------------------------- |
| `country` | `string` | Код страны (например, `ru`, `cn`). |

**Возвращает:**

- `string`: URL API.

### `generateSignature(path, _signedNonce, nonce, params)`

Генерирует подпись запроса для облачного API Xiaomi.

**Параметры:**

| Имя            | Тип      | Описание            |
| -------------- | -------- | ------------------- |
| `path`         | `string` | Путь API-запроса.   |
| `_signedNonce` | `string` | Подписанный nonce.  |
| `nonce`        | `string` | Nonce.              |
| `params`       | `object` | Параметры запроса.  |

**Возвращает:**

- `string`: Подпись запроса в base64.

### `generateNonce()`

Генерирует nonce для запросов к облачному API Xiaomi.

**Возвращает:**

- `string`: Nonce в base64.

### `signedNonce(ssecret, nonce)`

Генерирует подписанный nonce.

**Параметры:**

| Имя       | Тип      | Описание           |
| --------- | -------- | ------------------ |
| `ssecret` | `string` | Токен `ssecurity`. |
| `nonce`   | `string` | Nonce.             |

**Возвращает:**

- `string`: Подписанный nonce в base64.

